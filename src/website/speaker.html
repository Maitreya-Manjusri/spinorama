<%include file="header.html"/>
<%include file="nav_menu.html"/>

<%namespace name="util" module="utils" import="*"/>

<%include file="tabs_header.html"/>

<div class="section">
  <div class="content">
    <ul>
      <li><b>${meta[speaker].get('brand')}
          ${meta[speaker].get('model')}</b>
        Type: <b>${meta[speaker].get('type')}</b> Shape: <b>${meta[speaker].get('shape')}</b> Cost: <b>&pm;${meta[speaker].get('price', '?')}CHF</b> (${meta[speaker].get('amount', '?')}).</li>      
<%
    estimates = None
    pref_rating = None
    default = meta[speaker].get('default_measurement')
    if default is not None and default in meta[speaker]['measurements'].keys():
        estimates = meta[speaker]['measurements'][default].get('estimates', None)
        pref_rating = meta[speaker]['measurements'][default].get('pref_rating', None)
%>
% if estimates is not None:
      <li><b>-3dB</b> (resp. -6db) point v.s. reference is at <b>${estimates.get('ref_3dB')}Hz</b> (resp. ${estimates.get('ref_6dB')}Hz).
      Reference level is ${estimates.get('ref_level')}dB computed over [${estimates.get('ref_from')}Hz, ${estimates.get('ref_to')}Hz].
      Frequency deviation is <b>${estimates.get('ref_band')}dB</b> over the same frequency range.
      </li>
% endif
% if pref_rating is not None:
      <li>Preference Score is <b>${pref_rating.get('pref_score')}</b>
      and would be <b>${pref_rating.get('pref_score_wsub')}</b> with a
      perfect subwoofer. Score
      compononent details: NBD: ON ${pref_rating.get('nbd_on_axis')},
      LW ${pref_rating.get('nbd_listening_window')}, SP
      ${pref_rating.get('nbd_sound_power')}, PIR
      ${pref_rating.get('nbd_pred_in_room')}; SM:
      SP${pref_rating.get('sm_sound_power')},
      PIR${pref_rating.get('sm_pred_in_room')}; LFQ ${pref_rating.get('lfq')}, LFX ${pref_rating.get('lfx_hz')}Hz
      </li>
% endif
<%
    review = None
    reviews = None
    h_or_v = None
    if "default_measurement" in meta[speaker]:
        default =  meta[speaker]["default_measurement"]
        if default in meta[speaker]["measurements"].keys():
           compute = meta[speaker]["measurements"][default]
           review = compute.get("review", None)
           reviews = compute.get("reviews", None)
        if "horizontal" in default:
           h_or_v = "Horizontal"
        elif "vertical" in default:
           h_or_v = "Vertical"
%>
% if h_or_v is not None:
<li>${h_or_v} measurement</li>
% endif
% if review is not None:
<li>Link to <a href="${review}">Original review</a>.</li>
% endif
% if reviews is not None:
<li>
%   for pos, (key, review) in enumerate(reviews.items()):
%     if pos == 0:
Link to original Review: <a href="${review}">${key} review</a>.
%     elif pos == 1:
Links to other reviews: <a href="${review}">${key} review</a>
%     else:
, <a href="${review}">${key} review</a>
%     endif
%   endfor
.
</li>
% endif
    </ul>
  </div>
</div>

<!-- Mobile view: sequential-->
<div class="tab-pane is-active" id="pane-1">
  <ul>
    % for freq in g_freq:
    <li>
      <div>
	<a href="${g_key}/${freq | space2url}.html"><img class="graph" src="${g_key}/${freq | space2url}.jpg"/></a>
      </div>
    </li>
    <li>${freq}</li>
    % endfor
    % for contour in g_contour:
    <li>${contour | unmeltC }</li>
    <div>
      <a href="${g_key}/${contour | unmeltC, space2url}.html">
	<img class="graph" src="${g_key}/${contour | unmeltC, space2url}.jpg"/>
      </a>
    </div>
    % endfor
    % for radar in g_radar:
    <div>
      <a href="${g_key}/${radar | unmeltR, space2url}.html">
	<img class="graph" src="${g_key}/${radar | unmeltR, space2url}.jpg"/>
      </a>
    </div>
    <li>${radar | unmeltR }</li>
    % endfor
    % for isoband in g_isoband:
    <div>
      <img class="graph" src="${g_key}/${isoband | unmeltI, space2url}.jpg"/>
    </div>
    <li>${isoband | unmeltI }</li>
    % endfor
    % for directivity in g_directivity:
    <div>
      <img class="graph" src="${g_key}/${directivity | unmeltR, space2url}.jpg"/>
    </div>
    <li>${directivity | unmeltR }</li>
    % endfor
  </ul>
</div>
<!-- Laptop view: 2 cols-->
<div class="tab-pane display:none" id="pane-2">
  <div id="vis2"></div>
  <figure class="image">
    <img class="graph" src="${g_key}/2cols.jpg" alt="all graphs"/>
  </figure>
</div>
<!-- EQ view: sequential-->
% if 'default_measurement' in meta[speaker] and 'pref_rating_eq' in meta[speaker]['measurements'][meta[speaker]['default_measurement']]:
<div class="tab-pane" id="pane-3">
  % if g_eq is not None:
  <ul>
    % for freq in g_freq:
    <li>
      <div>
	<a href="${g_key}_eq/${freq | space2url}.html"><img class="graph" src="${g_key}_eq/${freq | space2url}.jpg"/></a>
      </div>
    </li>
    <li>${freq}</li>
    % endfor
    % for contour in g_contour:
    <li>${contour | unmeltC }</li>
    <div>
      <a href="${g_key}_eq/${contour | unmeltC, space2url}.html">
	<img class="graph" src="${g_key}_eq/${contour | unmeltC, space2url}.jpg"/>
      </a>
    </div>
    % endfor
    % for radar in g_radar:
    <div>
      <a href="${g_key}_eq/${radar | unmeltR, space2url}.html">
	<img class="graph" src="${g_key}_eq/${radar | unmeltR, space2url}.jpg"/>
      </a>
    </div>
    <li>${radar | unmeltR }</li>
    % endfor
    % for isoband in g_isoband:
    <div>
      <img class="graph" src="${g_key}_eq/${isoband | unmeltI, space2url}.jpg"/>
    </div>
    <li>${isoband | unmeltI }</li>
    % endfor
    % for directivity in g_directivity:
    <div>
      <img class="graph" src="${g_key}_eq/${directivity | unmeltR, space2url}.jpg"/>
    </div>
    <li>${directivity | unmeltR }</li>
    % endfor
  </ul>
  % endif
</div>
% endif
<!-- Desktop view: Ref vs. EQ views-->
% if 'default_measurement' in meta[speaker] and 'pref_rating_eq' in meta[speaker]['measurements'][meta[speaker]['default_measurement']]:
<div class="tab-pane display:none" id="pane-4">
  <div id="vis4"></div>
  <table>
  % for freq in g_freq:
  <tr>
    <td><img class="graph" src="${g_key}/${freq | space2url}.jpg"/></td>
    <td><img class="graph" src="${g_key}_eq/${freq | space2url}.jpg"/></td>
  </tr>
  % endfor
  % for isoband in g_isoband:
  <tr>
      <td><img class="graph" src="${g_key}/${isoband | unmeltI, space2url}.jpg"/></td>
      <td><img class="graph" src="${g_key}_eq/${isoband | unmeltI, space2url}.jpg"/></td>
  </tr>
  % endfor
  </table>
</div>
% endif

<%include file="tabs_footer.html"/>

<%include file="footer.html"/>
